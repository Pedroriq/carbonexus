<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <title>CarboNexus</title>
    <link href="https://fonts.googleapis.com/css2?family=Roboto:wght@400;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" type="text/css" href="{{ url_for('static', filename='style/style.css') }}">
</head>

<body>
    <main>
        <div class="container">

            <header>
                <img src="{{ url_for('static', filename='images/carbonexus_title.svg') }}" alt="CarboNexus" class="title-img">
            </header>

            <section class="information">
                <form action="/submit" method="POST">
                    <div class="form-group">
                        <label for="git-url">Github URL: </label>
                        <input type="text" id="git-url" name="git-url" required placeholder="https://github.com/YourNickname/YourRepoository.git">
                    </div>

                    <div class="form-group">
                        <label for="country">País: </label>
                        <input type="text" id="country" name="country" required placeholder="País" autocomplete="off">
                        <div id="suggestions"></div>
                    </div>

                    <button type="submit">Iniciar treinamento</button>
                </form>
            </section>
        </div>
    </main>
</body>

<script>
    async function getRequest(url = '') {
    const response = await fetch(url, {
        method: 'GET',
        cache: 'no-cache'
    })
    return response.json()
    }
    document.addEventListener('DOMContentLoaded', function () {
        let url = document.location
        let route = "/flaskwebgui-keep-server-alive"
        let interval_request = 3 * 1000 //sec
        function keep_alive_server() {
            getRequest(url + route)
                .then(data => console.log(data))
        }
        setInterval(keep_alive_server, interval_request)()
    })


    const input = document.getElementById('country');
        const suggestionsBox = document.getElementById('suggestions');
        let cities = [];

        // Função para buscar dados da API
        async function fetchCities() {
            try {
                const response = await fetch('https://api.electricitymap.org/v3/zones');
                const data = await response.json();
                cities = Object.values(data).map(zone => zone.zoneName); // Extrai o zoneName
            } catch (error) {
                console.error('Erro ao buscar dados da API:', error);
            }
        }

        // Função para exibir sugestões com base no valor digitado
        function showSuggestions(query) {
            suggestionsBox.innerHTML = ''; // Limpa as sugestões anteriores
            if (query.length === 0) {
                suggestionsBox.style.display = 'none';
                return;
            }
            const filteredCities = cities.filter(city => city.toLowerCase().includes(query.toLowerCase()));
            if (filteredCities.length > 0) {
                filteredCities.forEach(city => {
                    const suggestionItem = document.createElement('div');
                    suggestionItem.textContent = city;
                    suggestionItem.onclick = () => {
                        input.value = city;
                        suggestionsBox.style.display = 'none';
                    };
                    suggestionsBox.appendChild(suggestionItem);
                });
                suggestionsBox.style.display = 'block';
            } else {
                suggestionsBox.style.display = 'none';
            }
        }

        // Evento para capturar a entrada do usuário e exibir as sugestões
        input.addEventListener('input', () => showSuggestions(input.value));

        // Busca inicial dos dados ao carregar a página
        window.onload = fetchCities;
</script>
</html>
